#!/usr/bin/env python3
"""
Демонстрация того, как формируется промпт в новой версии.
Этот скрипт показывает финальный промпт без выполнения запроса к LLM.
"""

# Пример пользовательского промпта
user_prompt = """Проанализируй обращения клиентов и определи теги для каждого.
Теги должны отражать основную тему обращения."""

# Пример существующих тегов (найденных ранее)
existing_tags = {
    "авторизация": "Проблемы со входом в систему",
    "пароль": "Восстановление или смена пароля",
    "доставка": "Вопросы по доставке товаров"
}

# Пример обращений
requests = [
    "Не могу зайти в аккаунт",
    "Потерял пароль",
    "Медленный интернет"
]

max_tags = 2

# Формируем промпт так же, как это делается в tag_batch
existing_tags_text = ""
if existing_tags:
    existing_tags_text = "\n\nСуществующие теги (используй их если подходят):\n"
    for tag_name, description in existing_tags.items():
        existing_tags_text += f"- {tag_name}: {description}\n"

requests_text = "\n".join([f"{i+1}. {req}" for i, req in enumerate(requests)])

full_prompt = f"""{user_prompt}{existing_tags_text}

Обращения для тегирования:
{requests_text}

Верни ТОЛЬКО валидный JSON массив в формате:
[
  {{"tags": ["тег1", "тег2"], "descriptions": {{"тег1": "описание1", "тег2": "описание2"}}}},
  {{"tags": ["тег3"], "descriptions": {{"тег3": "описание3"}}}},
  ...
]

Правила:
- Максимум {max_tags} тегов на обращение
- Если тег определить невозможно, верни {{"tags": [], "descriptions": {{}}}}
- Количество элементов в массиве должно быть равно количеству обращений ({len(requests)})
- НЕ добавляй никакого текста до или после JSON массива
"""

print("=" * 80)
print("ПРИМЕР ФИНАЛЬНОГО ПРОМПТА")
print("=" * 80)
print("\n1. Пользовательский промпт (то, что передается в функцию tag):")
print("-" * 80)
print(user_prompt)
print("-" * 80)

print("\n2. Существующие теги (автоматически добавляются):")
print("-" * 80)
for tag, desc in existing_tags.items():
    print(f"  • {tag}: {desc}")
print("-" * 80)

print("\n3. ФИНАЛЬНЫЙ ПРОМПТ, отправляемый в LLM:")
print("=" * 80)
print(full_prompt)
print("=" * 80)

print("\nКАК ЭТО РАБОТАЕТ:")
print("-" * 80)
print("1. Вы передаете в функцию tag() только свой промпт")
print("2. Система автоматически добавляет существующие теги")
print("3. Система добавляет обращения для тегирования")
print("4. Система добавляет инструкции по формату ответа")
print("-" * 80)

